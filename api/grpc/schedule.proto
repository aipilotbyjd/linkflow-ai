syntax = "proto3";

package linkflow.schedule.v1;

option go_package = "github.com/linkflow-ai/linkflow-ai/api/grpc/schedule/v1;schedulepb";

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

// ScheduleService provides schedule management operations
service ScheduleService {
  // Create a new schedule
  rpc CreateSchedule(CreateScheduleRequest) returns (Schedule);
  
  // Get schedule by ID
  rpc GetSchedule(GetScheduleRequest) returns (Schedule);
  
  // List schedules
  rpc ListSchedules(ListSchedulesRequest) returns (ListSchedulesResponse);
  
  // Update schedule
  rpc UpdateSchedule(UpdateScheduleRequest) returns (Schedule);
  
  // Delete schedule
  rpc DeleteSchedule(DeleteScheduleRequest) returns (google.protobuf.Empty);
  
  // Pause schedule
  rpc PauseSchedule(PauseScheduleRequest) returns (Schedule);
  
  // Resume schedule
  rpc ResumeSchedule(ResumeScheduleRequest) returns (Schedule);
  
  // Trigger schedule immediately
  rpc TriggerSchedule(TriggerScheduleRequest) returns (TriggerScheduleResponse);
  
  // Get schedule execution history
  rpc GetScheduleHistory(GetScheduleHistoryRequest) returns (GetScheduleHistoryResponse);
  
  // Get next run times
  rpc GetNextRunTimes(GetNextRunTimesRequest) returns (GetNextRunTimesResponse);
  
  // Validate cron expression
  rpc ValidateCronExpression(ValidateCronExpressionRequest) returns (ValidateCronExpressionResponse);
}

// Schedule message
message Schedule {
  string id = 1;
  string workflow_id = 2;
  string user_id = 3;
  string organization_id = 4;
  string name = 5;
  string description = 6;
  string cron_expression = 7;
  string timezone = 8;
  ScheduleStatus status = 9;
  google.protobuf.Timestamp start_date = 10;
  google.protobuf.Timestamp end_date = 11;
  google.protobuf.Timestamp next_run = 12;
  google.protobuf.Timestamp last_run = 13;
  int64 execution_count = 14;
  int64 failure_count = 15;
  ScheduleConfig config = 16;
  map<string, string> metadata = 17;
  google.protobuf.Timestamp created_at = 18;
  google.protobuf.Timestamp updated_at = 19;
}

// ScheduleStatus enum
enum ScheduleStatus {
  SCHEDULE_STATUS_UNSPECIFIED = 0;
  SCHEDULE_STATUS_ACTIVE = 1;
  SCHEDULE_STATUS_PAUSED = 2;
  SCHEDULE_STATUS_COMPLETED = 3;
  SCHEDULE_STATUS_DISABLED = 4;
}

// ScheduleConfig message
message ScheduleConfig {
  bool catch_up = 1;
  int32 max_concurrent = 2;
  int32 retry_attempts = 3;
  int32 retry_delay_seconds = 4;
  int32 timeout_seconds = 5;
  map<string, string> input = 6;
}

// ScheduleExecution message
message ScheduleExecution {
  string id = 1;
  string schedule_id = 2;
  string execution_id = 3;
  google.protobuf.Timestamp scheduled_time = 4;
  google.protobuf.Timestamp actual_time = 5;
  ScheduleExecutionStatus status = 6;
  string error = 7;
  int64 duration_ms = 8;
}

// ScheduleExecutionStatus enum
enum ScheduleExecutionStatus {
  SCHEDULE_EXECUTION_STATUS_UNSPECIFIED = 0;
  SCHEDULE_EXECUTION_STATUS_PENDING = 1;
  SCHEDULE_EXECUTION_STATUS_RUNNING = 2;
  SCHEDULE_EXECUTION_STATUS_COMPLETED = 3;
  SCHEDULE_EXECUTION_STATUS_FAILED = 4;
  SCHEDULE_EXECUTION_STATUS_SKIPPED = 5;
}

// CreateScheduleRequest message
message CreateScheduleRequest {
  string workflow_id = 1;
  string name = 2;
  string description = 3;
  string cron_expression = 4;
  string timezone = 5;
  google.protobuf.Timestamp start_date = 6;
  google.protobuf.Timestamp end_date = 7;
  ScheduleConfig config = 8;
  map<string, string> metadata = 9;
}

// GetScheduleRequest message
message GetScheduleRequest {
  string id = 1;
}

// ListSchedulesRequest message
message ListSchedulesRequest {
  string workflow_id = 1;
  ScheduleStatus status = 2;
  int32 page = 3;
  int32 page_size = 4;
  string sort_by = 5;
  string sort_order = 6;
}

// ListSchedulesResponse message
message ListSchedulesResponse {
  repeated Schedule schedules = 1;
  int32 total_count = 2;
  int32 page = 3;
  int32 page_size = 4;
}

// UpdateScheduleRequest message
message UpdateScheduleRequest {
  string id = 1;
  string name = 2;
  string description = 3;
  string cron_expression = 4;
  string timezone = 5;
  google.protobuf.Timestamp start_date = 6;
  google.protobuf.Timestamp end_date = 7;
  ScheduleConfig config = 8;
  map<string, string> metadata = 9;
}

// DeleteScheduleRequest message
message DeleteScheduleRequest {
  string id = 1;
}

// PauseScheduleRequest message
message PauseScheduleRequest {
  string id = 1;
}

// ResumeScheduleRequest message
message ResumeScheduleRequest {
  string id = 1;
}

// TriggerScheduleRequest message
message TriggerScheduleRequest {
  string id = 1;
  map<string, string> override_input = 2;
}

// TriggerScheduleResponse message
message TriggerScheduleResponse {
  string execution_id = 1;
  ScheduleExecution execution = 2;
}

// GetScheduleHistoryRequest message
message GetScheduleHistoryRequest {
  string schedule_id = 1;
  int32 page = 2;
  int32 page_size = 3;
  google.protobuf.Timestamp start_date = 4;
  google.protobuf.Timestamp end_date = 5;
  ScheduleExecutionStatus status = 6;
}

// GetScheduleHistoryResponse message
message GetScheduleHistoryResponse {
  repeated ScheduleExecution executions = 1;
  int32 total_count = 2;
}

// GetNextRunTimesRequest message
message GetNextRunTimesRequest {
  string schedule_id = 1;
  int32 count = 2;
}

// GetNextRunTimesResponse message
message GetNextRunTimesResponse {
  repeated google.protobuf.Timestamp next_runs = 1;
}

// ValidateCronExpressionRequest message
message ValidateCronExpressionRequest {
  string cron_expression = 1;
}

// ValidateCronExpressionResponse message
message ValidateCronExpressionResponse {
  bool valid = 1;
  string error = 2;
  string description = 3;
  repeated google.protobuf.Timestamp next_runs = 4;
}
